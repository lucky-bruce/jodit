<!doctype html>
<html>
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <meta http-equiv="X-UA-Compatible" content="ie=edge"/>
    <title>Jodit Example</title>
    <script>
        var simulateEvent = function (type, keyCodeArg, element, options) {
            var evt = document.createEvent('HTMLEvents')
            evt.initEvent(type, true, true);
            evt.keyCode = keyCodeArg;
            evt.which = keyCodeArg;
            if (options) {
                options(evt);
            }
            element.dispatchEvent(evt);
        }
    </script>
</head>
<body>
    <table style="width:100%">
        <tr>
            <td style="width:50%;vertical-align: top">
                <div id="uniqbox" class="box">
                    <textarea id="editor">&lt;div&gt;
        &lt;img src="http://xdsoft.net/jodit/images/artio.jpg" style="width: 301px; float: right; margin-left: 15px; margin-top: 10px;"/&gt;
    &lt;/div&gt;
    &lt;ul&gt;
        &lt;li&gt;Copy/Paste image&lt;/li&gt;
        &lt;li&gt;Drag&amp;Drop &lt;/li&gt;
        &lt;li&gt;Split Mode&lt;/li&gt;
        &lt;li&gt;Free for non-Commercial&lt;/li&gt;
        &lt;li&gt;CodeMirror out of the box &lt;/li&gt;
        &lt;li&gt;Pure JavaScript. No libraries&lt;/li&gt;
        &lt;li&gt;Lightweight: ~32kB gzipped.&lt;/li&gt;
    &lt;/ul&gt;</textarea>
                </div>
            </td>
            <td><textarea id="mirror"></textarea></td>
        </tr>
    </table>
    <style>
        .jodit.jodit_editor, textarea {
            box-sizing: border-box;
            display: block;
            width: 100%;
            min-height: 200px;
            border:1px solid #ccc;
        }
        body {
            font-family: 'Source Sans Pro', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        }
    </style>
</body>
<link rel="stylesheet" href="app.css" />-
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,700,700i" rel="stylesheet">

<script src="dist/jodit.js"></script>
</html>

<script>
    function expect(value) {
        return {
            to: {
                equal: function (val) {
                    console.log(value === val);
                }
            }
        };
    }
    editor = new Jodit('#editor', {
        observer: {
            timeout: 0
        },
//        uploader: {
//            url: 'http://localhost:8181/index-test.php?action=upload'
//        },
//        filebrowser: {
//            ajax: {
//                url: 'http://localhost:8181/index-test.php'
//            }
//        },
        //debugLanguage: true,
        buttons: Jodit.defaultOptions.buttons.concat([
            {
                name: 'insertDate',
                iconURL: 'http://xdsoft.net/jodit/logo.png',
                exec: function (editor) {
                    editor.selection.insertHTML((new Date).toDateString());
                }
            }
        ])
    });

    function simpleKeys (original) {
        var newobject = {};
        for(var key in original) {
            newobject[key] = typeof original[key] === 'object' ? '{ ... }' : original[key];
        }
        return newobject;
    }
    var timeout,
        callback = function (e) {
            clearTimeout(timeout);
            timeout = setTimeout(function () {
                mirror.value = editor.editor.innerHTML;
            }, 100)
        }
    editor.editor.addEventListener('keydown', callback)
    editor.editor.addEventListener('keyup', callback)
    editor.editor.addEventListener('mousedown', callback)
    editor.editor.addEventListener('mouseup', callback)
    editor.editor.addEventListener('input', callback)
    editor.events.on('change', callback)

    editor.setEditorValue('text2text')
    var sel = editor.win.getSelection(), range = editor.doc.createRange();
    range.setStart(editor.editor.firstChild, 3)
    range.setEnd(editor.editor.firstChild, 6)
    sel.removeAllRanges();
    sel.addRange(range)
    simulateEvent('mousedown', 0, editor.container.querySelector('.jodit_toolbar_btn.jodit_toolbar_btn-brush'))
    var list = editor.container.querySelector('.jodit_toolbar_popup');
    expect(list.style.display).to.equal('block');
    simulateEvent('mousedown', 0, editor.container.querySelector('.jodit_toolbar_btn.jodit_toolbar_btn-brush [data-color="#F9CB9C"]'))
    expect(editor.getEditorValue()).to.equal('tex<span style="background-color: rgb(249, 203, 156);">t2t</span>ext');
    // simulateEvent('mousedown', 0, editor.editor)
    expect(list.style.display).to.equal('none');
    range.selectNodeContents(editor.editor.querySelector('span'))
    // range.collapse(true);
    sel.removeAllRanges();
    sel.addRange(range)
    simulateEvent('mousedown', 0, editor.container.querySelector('.jodit_toolbar_btn.jodit_toolbar_btn-brush'))
    expect(list.style.display).to.equal('block');
    simulateEvent('mousedown', 0, editor.container.querySelector('.jodit_toolbar_btn.jodit_toolbar_btn-brush .jodit_colorpicker > a > svg'))
    expect(editor.getEditorValue()).to.equal('text2text');
//    simulateEvent('mousedown', 0, editor.container.querySelector('.jodit_toolbar_btn.jodit_toolbar_btn-brush'))
//    expect(list.style.display).to.equal('block');
//    simulateEvent('mousedown', 0, editor.container.querySelector('.jodit_toolbar_btn.jodit_toolbar_btn-brush .jodit_colorpicker > a > svg'))
//    expect(editor.getEditorValue()).to.equal('text2text');

//    editor.selection.insertNode(document.createTextNode(' 2 '));
//    expect(editor.getEditorValue()).to.be.equal('<p>test 2 </p>');

//    editor.execCommand('fontSize', false, '12%');
//    expect(editor.getEditorValue()).to.equal('<p> testy oprst <span style="font-size: 12%;">lets go</span></p>');

    //    expect(parseInt(editor.container.querySelector('.jodit_table_resizer').style.left, 10) < 50).to.equal(true);

//    expect(list.style.display).to.equal('none');

//    editor.setEditorValue('<img src="/test/tests/artio.jpg"/>')

//    simulateEvent('mousedown', 0, editor.editor.querySelector('img'));
//    simulateEvent('mouseup', 0, editor.editor.querySelector('img'));
//    var resizer = document.querySelector('.jodit_resizer');

//    console.log(resizer.style.display === 'block');
//    editor.setEditorValue('Some text');
//    var sel = editor.win.getSelection(),
//        range = editor.doc.createRange();
//    range.setStart(editor.editor.firstChild, 9);
//    range.collapse(true);
//    sel.removeAllRanges();
//    sel.addRange(range);
//    simulateEvent('keydown',     Jodit.KEY_ENTER, editor.editor);
//    editor.selection.insertNode(editor.doc.createTextNode(' a '))
//    expect(editor.getEditorValue()).to.be.equal('<p>Some text</p><p> a </p>');

    callback();
</script>
